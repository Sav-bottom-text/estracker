<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Essential Tracker</title>
    <meta name="description" content="A beautiful daily essentials tracking app to ensure you have everything you need for work and life.">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
        /* CSS Variables and Theme System */
        :root {
            --background: hsl(240, 10%, 97%);
            --foreground: hsl(222.2, 84%, 4.9%);
            --muted: hsl(210, 40%, 96%);
            --muted-foreground: hsl(215.4, 16.3%, 46.9%);
            --popover: hsl(0, 0%, 100%);
            --popover-foreground: hsl(222.2, 84%, 4.9%);
            --card: hsl(0, 0%, 100%);
            --card-foreground: hsl(222.2, 84%, 4.9%);
            --border: hsl(214.3, 31.8%, 91.4%);
            --input: hsl(214.3, 31.8%, 91.4%);
            --primary: hsl(207, 90%, 54%);
            --primary-foreground: hsl(210, 40%, 98%);
            --secondary: hsl(210, 40%, 96%);
            --secondary-foreground: hsl(222.2, 84%, 4.9%);
            --accent: hsl(210, 40%, 96%);
            --accent-foreground: hsl(222.2, 84%, 4.9%);
            --destructive: hsl(0, 84.2%, 60.2%);
            --destructive-foreground: hsl(210, 40%, 98%);
            --ring: hsl(207, 90%, 54%);
            --radius: 0.75rem;
            
            /* Theme colors */
            --theme-gradient-from: hsl(240, 10%, 97%);
            --theme-gradient-to: hsl(214, 100%, 97%);
            --header-bg: hsl(0, 0%, 100%);
            --dashboard-gradient-from: hsl(229, 84%, 62%);
            --dashboard-gradient-via: hsl(262, 83%, 62%);
            --dashboard-gradient-to: hsl(330, 81%, 60%);
        }

        .dark {
            --background: hsl(222.2, 84%, 4.9%);
            --foreground: hsl(210, 40%, 98%);
            --muted: hsl(217.2, 32.6%, 17.5%);
            --muted-foreground: hsl(215, 20.2%, 65.1%);
            --popover: hsl(222.2, 84%, 4.9%);
            --popover-foreground: hsl(210, 40%, 98%);
            --card: hsl(222.2, 84%, 4.9%);
            --card-foreground: hsl(210, 40%, 98%);
            --border: hsl(217.2, 32.6%, 17.5%);
            --input: hsl(217.2, 32.6%, 17.5%);
            --primary: hsl(207, 90%, 54%);
            --primary-foreground: hsl(222.2, 84%, 4.9%);
            --secondary: hsl(217.2, 32.6%, 17.5%);
            --secondary-foreground: hsl(210, 40%, 98%);
            --accent: hsl(217.2, 32.6%, 17.5%);
            --accent-foreground: hsl(210, 40%, 98%);
            --destructive: hsl(0, 62.8%, 30.6%);
            --destructive-foreground: hsl(210, 40%, 98%);
            --ring: hsl(207, 90%, 54%);
            
            /* Dark theme colors */
            --theme-gradient-from: hsl(222.2, 84%, 4.9%);
            --theme-gradient-to: hsl(217.2, 32.6%, 17.5%);
            --header-bg: hsl(222.2, 84%, 4.9%);
            --dashboard-gradient-from: hsl(229, 84%, 45%);
            --dashboard-gradient-via: hsl(262, 83%, 45%);
            --dashboard-gradient-to: hsl(330, 81%, 45%);
        }

        .theme-cozy {
            --theme-gradient-from: hsl(24, 100%, 97%);
            --theme-gradient-to: hsl(0, 100%, 97%);
            --header-bg: hsl(0, 0%, 100%);
            --dashboard-gradient-from: hsl(24, 74%, 58%);
            --dashboard-gradient-via: hsl(7, 89%, 67%);
            --dashboard-gradient-to: hsl(346, 87%, 65%);
        }

        .theme-ocean {
            --theme-gradient-from: hsl(195, 100%, 97%);
            --theme-gradient-to: hsl(188, 100%, 97%);
            --header-bg: hsl(0, 0%, 100%);
            --dashboard-gradient-from: hsl(195, 100%, 62%);
            --dashboard-gradient-via: hsl(188, 100%, 62%);
            --dashboard-gradient-to: hsl(200, 100%, 62%);
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(to bottom right, var(--theme-gradient-from), var(--theme-gradient-to));
            color: hsl(var(--foreground));
            min-height: 100vh;
            transition: all 0.5s ease;
        }

        .font-inter {
            font-family: 'Inter', sans-serif;
        }

        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }

        /* Animation Control */
        .no-animations * {
            animation-duration: 0s !important;
            transition-duration: 0s !important;
        }

        /* Utility Classes */
        .hidden { display: none; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .space-x-2 > * + * { margin-left: 0.5rem; }
        .space-x-3 > * + * { margin-left: 0.75rem; }
        .space-x-4 > * + * { margin-left: 1rem; }
        .space-x-6 > * + * { margin-left: 1.5rem; }
        .space-y-2 > * + * { margin-top: 0.5rem; }
        .space-y-3 > * + * { margin-top: 0.75rem; }
        .space-y-4 > * + * { margin-top: 1rem; }
        .space-y-6 > * + * { margin-top: 1.5rem; }
        .text-center { text-align: center; }
        .text-sm { font-size: 0.875rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-3xl { font-size: 1.875rem; }
        .text-4xl { font-size: 2.25rem; }
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        .w-4 { width: 1rem; }
        .w-5 { width: 1.25rem; }
        .w-6 { width: 1.5rem; }
        .w-8 { width: 2rem; }
        .w-10 { width: 2.5rem; }
        .w-12 { width: 3rem; }
        .w-14 { width: 3.5rem; }
        .w-24 { width: 6rem; }
        .w-full { width: 100%; }
        .h-4 { height: 1rem; }
        .h-5 { height: 1.25rem; }
        .h-6 { height: 1.5rem; }
        .h-8 { height: 2rem; }
        .h-10 { height: 2.5rem; }
        .h-12 { height: 3rem; }
        .h-14 { height: 3.5rem; }
        .h-24 { height: 6rem; }
        .h-auto { height: auto; }
        .min-h-screen { min-height: 100vh; }
        .p-1 { padding: 0.25rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
        .py-6 { padding-top: 1.5rem; padding-bottom: 1.5rem; }
        .py-12 { padding-top: 3rem; padding-bottom: 3rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        .max-w-4xl { max-width: 56rem; }
        .max-w-md { max-width: 28rem; }
        .max-w-lg { max-width: 32rem; }
        .rounded-sm { border-radius: 0.125rem; }
        .rounded-md { border-radius: 0.375rem; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-xl { border-radius: 0.75rem; }
        .rounded-2xl { border-radius: 1rem; }
        .rounded-full { border-radius: 9999px; }
        .border { border-width: 1px; }
        .border-2 { border-width: 2px; }
        .border-4 { border-width: 4px; }
        .border-b { border-bottom-width: 1px; }
        .border-t { border-top-width: 1px; }
        .shadow-sm { box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.05); }
        .shadow-xl { box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 10px 10px -5px rgb(0 0 0 / 0.04); }
        .shadow-2xl { box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25); }
        .sticky { position: sticky; }
        .fixed { position: fixed; }
        .relative { position: relative; }
        .absolute { position: absolute; }
        .top-0 { top: 0; }
        .bottom-6 { bottom: 1.5rem; }
        .right-6 { right: 1.5rem; }
        .inset-0 { top: 0; right: 0; bottom: 0; left: 0; }
        .z-40 { z-index: 40; }
        .z-50 { z-index: 50; }
        .z-100 { z-index: 100; }
        .overflow-hidden { overflow: hidden; }
        .overflow-y-auto { overflow-y: auto; }
        .cursor-pointer { cursor: pointer; }
        .select-none { user-select: none; }
        .transform { transform: translateX(var(--tw-translate-x)) translateY(var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }
        .transition-all { transition-property: all; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
        .transition-colors { transition-property: color, background-color, border-color, text-decoration-color, fill, stroke; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
        .transition-transform { transition-property: transform; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
        .duration-200 { transition-duration: 200ms; }
        .duration-300 { transition-duration: 300ms; }
        .duration-500 { transition-duration: 500ms; }
        .ease-in-out { transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); }
        .ease-out { transition-timing-function: cubic-bezier(0, 0, 0.2, 1); }

        /* Color Classes */
        .bg-card { background-color: hsl(var(--card)); }
        .bg-muted { background-color: hsl(var(--muted)); }
        .bg-primary { background-color: hsl(var(--primary)); }
        .bg-red-100 { background-color: hsl(0, 100%, 95%); }
        .bg-blue-100 { background-color: hsl(220, 100%, 95%); }
        .bg-green-500 { background-color: hsl(142, 76%, 36%); }
        .bg-gray-200 { background-color: hsl(220, 14%, 96%); }
        .bg-white { background-color: hsl(0, 0%, 100%); }
        .text-foreground { color: hsl(var(--foreground)); }
        .text-muted-foreground { color: hsl(var(--muted-foreground)); }
        .text-primary { color: hsl(var(--primary)); }
        .text-white { color: hsl(0, 0%, 100%); }
        .text-red-400 { color: hsl(0, 84%, 60%); }
        .text-red-600 { color: hsl(0, 84%, 50%); }
        .text-blue-600 { color: hsl(220, 84%, 50%); }
        .text-green-600 { color: hsl(142, 76%, 36%); }
        .text-indigo-600 { color: hsl(231, 48%, 48%); }
        .border-border { border-color: hsl(var(--border)); }
        .border-gray-300 { border-color: hsl(220, 14%, 78%); }
        .border-green-500 { border-color: hsl(142, 76%, 36%); }
        .border-red-200 { border-color: hsl(0, 100%, 90%); }
        .border-blue-200 { border-color: hsl(220, 100%, 90%); }

        /* Hover States */
        .hover\:bg-accent:hover { background-color: hsl(var(--accent)); }
        .hover\:bg-muted:hover { background-color: hsl(var(--muted)); }
        .hover\:bg-red-200:hover { background-color: hsl(0, 100%, 90%); }
        .hover\:bg-blue-200:hover { background-color: hsl(220, 100%, 90%); }
        .hover\:text-foreground:hover { color: hsl(var(--foreground)); }
        .hover\:text-red-600:hover { color: hsl(0, 84%, 50%); }
        .hover\:scale-110:hover { transform: scale(1.1); }
        .hover\:shadow-2xl:hover { box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25); }

        /* Grid */
        .grid { display: grid; }
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        .grid-cols-6 { grid-template-columns: repeat(6, minmax(0, 1fr)); }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .gap-6 { gap: 1.5rem; }

        /* Responsive */
        @media (min-width: 768px) {
            .md\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        }
        @media (min-width: 1024px) {
            .lg\:col-span-2 { grid-column: span 2 / span 2; }
            .lg\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
            .lg\:text-4xl { font-size: 2.25rem; }
        }

        /* Component Styles */
        .header-bg { background-color: var(--header-bg); }
        .dashboard-gradient {
            background: linear-gradient(to right, var(--dashboard-gradient-from), var(--dashboard-gradient-via), var(--dashboard-gradient-to));
        }

        /* Button Styles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius);
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(to right, hsl(231, 48%, 48%), hsl(262, 83%, 58%));
            color: white;
            padding: 0.5rem 1rem;
        }

        .btn-primary:hover {
            background: linear-gradient(to right, hsl(231, 48%, 42%), hsl(262, 83%, 52%));
        }

        .btn-outline {
            background: hsl(var(--card));
            color: hsl(var(--foreground));
            border: 1px solid hsl(var(--border));
            padding: 0.5rem 1rem;
        }

        .btn-outline:hover {
            background: hsl(var(--accent));
        }

        .btn-ghost {
            background: transparent;
            color: hsl(var(--foreground));
            padding: 0.5rem;
        }

        .btn-ghost:hover {
            background: hsl(var(--accent));
        }

        .btn-destructive {
            background: hsl(var(--destructive));
            color: hsl(var(--destructive-foreground));
            padding: 0.5rem 1rem;
        }

        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
        }

        .btn-icon {
            width: 2.5rem;
            height: 2.5rem;
            padding: 0;
        }

        /* Input Styles */
        .input {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            background: hsl(var(--card));
            color: hsl(var(--foreground));
            font-size: 0.875rem;
        }

        .input:focus {
            outline: none;
            border-color: hsl(var(--primary));
            box-shadow: 0 0 0 2px hsl(var(--primary) / 0.2);
        }

        /* Select Styles */
        .select {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            background: hsl(var(--card));
            color: hsl(var(--foreground));
            font-size: 0.875rem;
            appearance: none;
            cursor: pointer;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            padding: 1rem;
        }

        .modal-content {
            background: hsl(var(--card));
            border-radius: var(--radius);
            padding: 1.5rem;
            width: 100%;
            max-width: 28rem;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25);
        }

        /* Checkbox Styles */
        .checkbox {
            width: 1.5rem;
            height: 1.5rem;
            border: 2px solid hsl(var(--border));
            border-radius: 0.375rem;
            background: hsl(var(--card));
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .checkbox.checked {
            background: hsl(142, 76%, 36%);
            border-color: hsl(142, 76%, 36%);
            color: white;
        }

        /* Category Item Animations */
        .category-items {
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
            overflow: hidden;
        }

        .category-items.collapsed {
            max-height: 0 !important;
            opacity: 0;
        }

        .category-items.expanded {
            opacity: 1;
        }

        /* Dropdown Arrow Animation */
        .dropdown-arrow {
            transition: transform 0.3s ease-in-out;
        }

        .dropdown-arrow.expanded {
            transform: rotate(180deg);
        }

        /* Progress Circle Animation */
        .progress-circle {
            transition: stroke-dashoffset 0.5s ease-in-out;
        }

        /* Animations */
        @keyframes bounce-subtle {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes scale-in {
            0% { transform: scale(0.9); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes slide-down {
            0% { transform: translateY(-10px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        @keyframes slide-up {
            0% { transform: translateY(10px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .animate-bounce-subtle {
            animation: bounce-subtle 0.6s ease-in-out;
        }

        .animate-scale-in {
            animation: scale-in 0.3s ease-out;
        }

        .animate-slide-down {
            animation: slide-down 0.3s ease-out;
        }

        .animate-slide-up {
            animation: slide-up 0.3s ease-out;
        }

        .animate-spin-slow {
            animation: spin 3s linear infinite;
        }

        /* Toast Styles */
        .toast {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: hsl(var(--card));
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            padding: 1rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            z-index: 100;
            min-width: 300px;
        }

        .toast.success {
            border-left: 4px solid hsl(142, 76%, 36%);
        }

        .toast.error {
            border-left: 4px solid hsl(0, 84%, 60%);
        }

        /* Toggle Switch */
        .toggle {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }

        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: hsl(var(--muted));
            transition: 0.4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        .toggle input:checked + .toggle-slider {
            background-color: hsl(var(--primary));
        }

        .toggle input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }

        /* Color Picker Grid */
        .color-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .color-option {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: transform 0.2s;
            border: 2px solid transparent;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.selected {
            border-color: hsl(var(--foreground));
            transform: scale(1.1);
        }

        /* Flex utilities */
        .flex-1 { flex: 1 1 0%; }

        /* Line through */
        .line-through { text-decoration: line-through; }

        /* Opacity */
        .opacity-50 { opacity: 0.5; }
        .opacity-80 { opacity: 0.8; }
        .opacity-90 { opacity: 0.9; }

        /* Responsive design improvements */
        @media (max-width: 768px) {
            .modal-content {
                margin: 1rem;
                max-width: calc(100vw - 2rem);
            }
            
            .text-3xl { font-size: 1.5rem; }
            .text-4xl { font-size: 1.875rem; }
            
            .grid-cols-3 {
                grid-template-columns: repeat(1, minmax(0, 1fr));
            }
            
            .space-x-6 > * + * { margin-left: 1rem; }
            
            .px-4 { padding-left: 1rem; padding-right: 1rem; }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading" class="min-h-screen flex items-center justify-center">
        <div class="animate-spin-slow w-8 h-8 border-4 border-primary border-t-transparent rounded-full"></div>
    </div>

    <!-- Main App -->
    <div id="app" class="min-h-screen hidden">
        <!-- App Bar -->
        <header class="header-bg shadow-lg border-b border-border sticky top-0 z-50 transition-all duration-300">
            <div class="max-w-4xl mx-auto px-4 py-4 flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <h1 class="text-2xl font-inter font-bold text-foreground" data-testid="app-title">
                        Essential Tracker
                    </h1>
                </div>
                
                <div class="flex items-center space-x-2">
                    <div class="relative">
                        <button class="btn btn-ghost btn-icon" onclick="toggleMenu()" data-testid="button-menu">
                            <i data-lucide="settings" class="w-5 h-5"></i>
                        </button>
                        
                        <div id="menu-dropdown" class="hidden absolute right-0 top-full mt-2 bg-card border border-border rounded-lg shadow-lg py-2 min-w-48 z-50">
                            <button class="w-full text-left px-4 py-2 hover:bg-muted transition-colors" onclick="openSettings(); toggleMenu()">
                                <i data-lucide="settings" class="w-4 h-4 inline mr-2"></i>
                                Settings
                            </button>
                            <div class="border-t border-border my-1"></div>
                            <button class="w-full text-left px-4 py-2 hover:bg-muted transition-colors" onclick="deleteAllItems(); toggleMenu()">
                                <i data-lucide="trash-2" class="w-4 h-4 inline mr-2"></i>
                                Delete All Items
                            </button>
                            <button class="w-full text-left px-4 py-2 hover:bg-muted transition-colors" onclick="deleteAllCategories(); toggleMenu()">
                                <i data-lucide="trash-2" class="w-4 h-4 inline mr-2"></i>
                                Delete All Categories
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-4xl mx-auto px-4 py-6 pb-24 space-y-6">
            <!-- Dashboard -->
            <div id="dashboard" class="bg-card rounded-2xl shadow-xl border border-border overflow-hidden">
                <!-- Top Section with Gradient -->
                <div class="dashboard-gradient p-6 text-white">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Date & Time Section -->
                        <div class="lg:col-span-2 space-y-4">
                            <div>
                                <p class="text-lg font-medium opacity-90" data-testid="text-greeting" id="greeting">
                                    Good Morning!
                                </p>
                                <div class="flex items-baseline space-x-4">
                                    <h2 class="text-3xl lg:text-4xl font-inter font-bold" data-testid="text-current-date" id="current-date">
                                        01/01/25
                                    </h2>
                                    <span class="text-xl font-medium opacity-80" data-testid="text-day-name" id="day-name">
                                        Monday
                                    </span>
                                </div>
                            </div>
                            
                            <div class="flex items-center space-x-6">
                                <div class="flex items-center space-x-2">
                                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8zm1-13h-2v6l5.25 3.15.75-1.23L13 11.4V7z"/>
                                    </svg>
                                    <span class="text-2xl font-mono font-semibold" data-testid="text-current-time" id="current-time">
                                        12:00:00 PM
                                    </span>
                                </div>
                                <button class="btn btn-outline btn-sm bg-white/20 border-white/30 text-white hover:bg-white/30" 
                                        data-testid="button-time-format" id="time-format-btn" onclick="toggleTimeFormat()">
                                    12H
                                </button>
                            </div>
                        </div>

                        <!-- Progress Ring -->
                        <div class="flex items-center justify-center">
                            <div class="relative w-24 h-24">
                                <svg class="w-24 h-24 transform -rotate-90" viewBox="0 0 100 100">
                                    <circle cx="50" cy="50" r="45" stroke="white" stroke-opacity="0.2" stroke-width="8" fill="none"/>
                                    <circle cx="50" cy="50" r="45" stroke="white" stroke-width="8" fill="none" 
                                            stroke-dasharray="283" stroke-dashoffset="283" stroke-linecap="round"
                                            class="progress-circle" data-testid="progress-circle" id="progress-circle"/>
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <span class="text-2xl font-bold" data-testid="text-progress" id="progress-text">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bottom Info Section -->
                <div class="p-6 bg-muted/30">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- Next Reset Timer -->
                        <div class="bg-card rounded-xl p-4 shadow-sm border border-border">
                            <h3 class="text-sm font-semibold text-muted-foreground mb-2">Next Reset In</h3>
                            <div class="flex items-center space-x-2">
                                <span class="text-xl font-mono font-bold text-indigo-600" data-testid="text-reset-timer" id="reset-timer">
                                    00:00:00
                                </span>
                                <button class="btn btn-outline btn-sm text-xs bg-red-100 text-red-600 border-red-200 hover:bg-red-200" 
                                        data-testid="button-reset-now" onclick="resetAllItems(false)">
                                    Reset Now
                                </button>
                            </div>
                        </div>

                        <!-- Notification Time -->
                        <div class="bg-card rounded-xl p-4 shadow-sm border border-border">
                            <h3 class="text-sm font-semibold text-muted-foreground mb-2">Notification Time</h3>
                            <div class="flex items-center space-x-2">
                                <span class="text-xl font-mono font-bold text-green-600" data-testid="text-notification-time" id="notification-time">
                                    08:00
                                </span>
                                <button class="btn btn-outline btn-sm text-xs bg-blue-100 text-blue-600 border-blue-200 hover:bg-blue-200" 
                                        data-testid="button-edit-notification" onclick="openEditNotification()">
                                    <i data-lucide="pencil" class="w-3 h-3"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Stats -->
                        <div class="bg-card rounded-xl p-4 shadow-sm border border-border">
                            <h3 class="text-sm font-semibold text-muted-foreground mb-2">Today's Progress</h3>
                            <div class="flex items-center space-x-4">
                                <span class="text-xl font-bold text-green-600" data-testid="text-completed-count" id="completed-count">0</span>
                                <span class="text-muted-foreground">/</span>
                                <span class="text-xl font-bold text-muted-foreground" data-testid="text-total-count" id="total-count">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Categories List -->
            <div id="categories-container" class="space-y-4">
                <!-- Categories will be rendered here -->
            </div>

            <!-- Empty State -->
            <div id="empty-state" class="text-center py-12 bg-card rounded-2xl shadow-lg border border-border hidden" data-testid="empty-state">
                <div class="w-24 h-24 bg-muted rounded-full flex items-center justify-center mx-auto mb-4">
                    <div class="w-8 h-8 border-2 border-muted-foreground rounded-sm opacity-50"></div>
                </div>
                <h3 class="text-xl font-semibold text-foreground mb-2">No essentials yet</h3>
                <p class="text-muted-foreground mb-6">Start by adding your first essential item</p>
                <button class="btn btn-primary" onclick="openAddItem()" data-testid="button-add-first-item">
                    Add Your First Essential
                </button>
            </div>
        </main>

        <!-- Floating Action Button -->
        <button class="fixed bottom-6 right-6 w-14 h-14 bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white rounded-full shadow-xl hover:shadow-2xl transform hover:scale-110 transition-all duration-300 z-40 flex items-center justify-center"
                data-testid="button-fab" onclick="openAddItem()">
            <i data-lucide="plus" class="w-6 h-6"></i>
        </button>
    </div>

    <!-- Add Item Modal -->
    <div id="add-item-modal" class="modal-overlay hidden" data-testid="modal-add-item">
        <div class="modal-content">
            <h2 class="text-2xl font-inter font-bold mb-4">Add Essential Item</h2>
            <form id="add-item-form" class="space-y-4">
                <div>
                    <label for="item-name" class="text-sm font-semibold text-foreground mb-2 block">Item Name</label>
                    <input type="text" id="item-name" class="input" placeholder="e.g., Laptop charger" data-testid="input-item-name" required>
                </div>
                <div>
                    <label for="item-category" class="text-sm font-semibold text-foreground mb-2 block">Category</label>
                    <select id="item-category" class="select" data-testid="select-item-category">
                        <option value="unsorted">Unsorted</option>
                    </select>
                    <button type="button" class="btn btn-ghost mt-2 p-0 h-auto text-sm text-primary font-medium" 
                            onclick="openAddCategoryFromItem()" data-testid="button-add-new-category">
                        + Add New Category
                    </button>
                </div>
                <div class="flex space-x-3 pt-4">
                    <button type="button" class="btn btn-outline flex-1" onclick="closeAddItem()" data-testid="button-cancel-add-item">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary flex-1" data-testid="button-submit-add-item">
                        Add Item
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div id="add-category-modal" class="modal-overlay hidden" data-testid="modal-add-category">
        <div class="modal-content">
            <h2 class="text-2xl font-inter font-bold mb-4">Add Category</h2>
            <form id="add-category-form" class="space-y-4">
                <div>
                    <label for="category-name" class="text-sm font-semibold text-foreground mb-2 block">Category Name</label>
                    <input type="text" id="category-name" class="input" placeholder="e.g., Work Items" data-testid="input-category-name" required>
                </div>
                <div>
                    <label class="text-sm font-semibold text-foreground mb-2 block">Color</label>
                    <div class="color-grid">
                        <div class="color-option selected" style="background-color: #EF4444" data-color="#EF4444" onclick="selectColor(this)"></div>
                        <div class="color-option" style="background-color: #F97316" data-color="#F97316" onclick="selectColor(this)"></div>
                        <div class="color-option" style="background-color: #EAB308" data-color="#EAB308" onclick="selectColor(this)"></div>
                        <div class="color-option" style="background-color: #22C55E" data-color="#22C55E" onclick="selectColor(this)"></div>
                        <div class="color-option" style="background-color: #3B82F6" data-color="#3B82F6" onclick="selectColor(this)"></div>
                        <div class="color-option" style="background-color: #A855F7" data-color="#A855F7" onclick="selectColor(this)"></div>
                        <div class="color-option" style="background-color: #EC4899" data-color="#EC4899" onclick="selectColor(this)"></div>
                        <div class="color-option" style="background-color: #6366F1" data-color="#6366F1" onclick="selectColor(this)"></div>
                        <div class="color-option" style="background-color: #6B7280" data-color="#6B7280" onclick="selectColor(this)"></div>
                        <div class="color-option" style="background-color: #14B8A6" data-color="#14B8A6" onclick="selectColor(this)"></div>
                        <div class="color-option" style="background-color: #06B6D4" data-color="#06B6D4" onclick="selectColor(this)"></div>
                        <div class="color-option" style="background-color: #10B981" data-color="#10B981" onclick="selectColor(this)"></div>
                    </div>
                    <input type="color" id="custom-color" class="input" value="#EF4444" data-testid="input-custom-color" onchange="updateCustomColor(this.value)">
                </div>
                <div class="flex space-x-3 pt-4">
                    <button type="button" class="btn btn-outline flex-1" onclick="closeAddCategory()" data-testid="button-cancel-add-category">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary flex-1" data-testid="button-submit-add-category">
                        Add Category
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal-overlay hidden" data-testid="modal-settings">
        <div class="modal-content">
            <h2 class="text-2xl font-inter font-bold mb-4">Settings</h2>
            <div class="space-y-6">
                <!-- Theme Settings -->
                <div>
                    <h3 class="text-lg font-semibold text-foreground mb-3">Theme</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <button class="btn btn-outline p-4 h-auto flex flex-col items-center space-y-2 theme-option selected" 
                                data-theme="light" onclick="selectTheme('light')" data-testid="theme-light">
                            <div class="w-full h-12 rounded-lg" style="background: linear-gradient(to right, #f8fafc, #e0f2fe)"></div>
                            <span class="text-sm font-medium">Light Mode</span>
                        </button>
                        <button class="btn btn-outline p-4 h-auto flex flex-col items-center space-y-2 theme-option" 
                                data-theme="dark" onclick="selectTheme('dark')" data-testid="theme-dark">
                            <div class="w-full h-12 rounded-lg" style="background: linear-gradient(to right, #0f172a, #1e293b)"></div>
                            <span class="text-sm font-medium">Dark Mode</span>
                        </button>
                        <button class="btn btn-outline p-4 h-auto flex flex-col items-center space-y-2 theme-option" 
                                data-theme="cozy" onclick="selectTheme('cozy')" data-testid="theme-cozy">
                            <div class="w-full h-12 rounded-lg" style="background: linear-gradient(to right, #fef3c7, #fed7d7)"></div>
                            <span class="text-sm font-medium">Cozy Warm</span>
                        </button>
                        <button class="btn btn-outline p-4 h-auto flex flex-col items-center space-y-2 theme-option" 
                                data-theme="ocean" onclick="selectTheme('ocean')" data-testid="theme-ocean">
                            <div class="w-full h-12 rounded-lg" style="background: linear-gradient(to right, #e0f7fa, #b2ebf2)"></div>
                            <span class="text-sm font-medium">Ocean Blue</span>
                        </button>
                    </div>
                </div>

                <!-- Toggles -->
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <label for="animations-toggle" class="font-semibold text-foreground">Animations</label>
                        <label class="toggle">
                            <input type="checkbox" id="animations-toggle" checked onchange="toggleAnimations(this.checked)" data-testid="toggle-animations">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="flex items-center justify-between">
                        <label for="hour-format-toggle" class="font-semibold text-foreground">24 Hour Format</label>
                        <label class="toggle">
                            <input type="checkbox" id="hour-format-toggle" onchange="toggleHourFormat(this.checked)" data-testid="toggle-hour-format">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Notification Time -->
                <div>
                    <h3 class="text-lg font-semibold text-foreground mb-3">Notification Time</h3>
                    <input type="time" id="notification-time-input" class="input" value="08:00" 
                           onchange="updateNotificationTime(this.value)" data-testid="input-notification-time">
                </div>

                <!-- Actions -->
                <div class="pt-4 border-t border-border">
                    <h3 class="text-lg font-semibold text-foreground mb-3">Actions</h3>
                    <div class="space-y-2">
                        <button class="btn btn-destructive w-full" onclick="deleteAllItems()" data-testid="button-delete-all-items">
                            <i data-lucide="trash-2" class="w-4 h-4 mr-2"></i>
                            Delete All Items
                        </button>
                        <button class="btn btn-destructive w-full" onclick="deleteAllCategories()" data-testid="button-delete-all-categories">
                            <i data-lucide="trash-2" class="w-4 h-4 mr-2"></i>
                            Delete All Categories
                        </button>
                    </div>
                </div>

                <div class="flex justify-end pt-4">
                    <button class="btn btn-outline" onclick="closeSettings()">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Notification Modal -->
    <div id="edit-notification-modal" class="modal-overlay hidden" data-testid="modal-edit-notification">
        <div class="modal-content">
            <h2 class="text-2xl font-inter font-bold mb-4">Edit Notification Time</h2>
            <form id="edit-notification-form" class="space-y-4">
                <div>
                    <label for="edit-notification-time" class="text-sm font-semibold text-foreground mb-2 block">Notification Time</label>
                    <input type="time" id="edit-notification-time" class="input" value="08:00" data-testid="input-edit-notification-time">
                </div>
                <div class="flex space-x-3 pt-4">
                    <button type="button" class="btn btn-outline flex-1" onclick="closeEditNotification()">Cancel</button>
                    <button type="submit" class="btn btn-primary flex-1">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <script>
        // Global state
        let appState = {
            categories: [
                { id: 'unsorted', name: 'Unsorted', color: '#6B7280', isSpecial: true }
            ],
            items: [],
            settings: {
                theme: 'light',
                animations: true,
                hourFormat: false,
                notificationTime: '08:00'
            },
            expandedCategories: new Set(),
            nextResetTime: null
        };

        let selectedCategoryColor = '#EF4444';

        // Utility functions
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function saveState() {
            localStorage.setItem('essentialTracker', JSON.stringify(appState));
        }

        function loadState() {
            const saved = localStorage.getItem('essentialTracker');
            if (saved) {
                const loaded = JSON.parse(saved);
                appState = { ...appState, ...loaded };
                
                // Ensure unsorted category exists
                if (!appState.categories.find(cat => cat.id === 'unsorted')) {
                    appState.categories.unshift({ id: 'unsorted', name: 'Unsorted', color: '#6B7280', isSpecial: true });
                }
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div class="font-semibold">${type === 'success' ? 'Success' : 'Error'}</div>
                <div class="text-sm text-muted-foreground mt-1">${message}</div>
            `;
            
            document.getElementById('toast-container').appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Time and date functions
        function updateDateTime() {
            const now = new Date();
            
            // Update greeting
            const hour = now.getHours();
            let greeting;
            if (hour < 12) greeting = "Good Morning!";
            else if (hour < 17) greeting = "Good Afternoon!";
            else greeting = "Good Evening!";
            document.getElementById('greeting').textContent = greeting;
            
            // Update date
            const day = String(now.getDate()).padStart(2, '0');
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const year = String(now.getFullYear()).slice(-2);
            document.getElementById('current-date').textContent = `${day}/${month}/${year}`;
            
            // Update day name
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            document.getElementById('day-name').textContent = days[now.getDay()];
            
            // Update time
            const hours = now.getHours();
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            
            let timeString;
            if (appState.settings.hourFormat) {
                timeString = `${String(hours).padStart(2, '0')}:${minutes}:${seconds}`;
            } else {
                const ampm = hours >= 12 ? 'PM' : 'AM';
                const displayHours = hours % 12 || 12;
                timeString = `${String(displayHours).padStart(2, '0')}:${minutes}:${seconds} ${ampm}`;
            }
            document.getElementById('current-time').textContent = timeString;
            
            // Update time format button
            document.getElementById('time-format-btn').textContent = appState.settings.hourFormat ? '24H' : '12H';
        }

        function calculateNextResetTime() {
            const now = new Date();
            const [hours, minutes] = appState.settings.notificationTime.split(':').map(Number);
            
            const nextReset = new Date();
            nextReset.setHours(hours, minutes, 0, 0);
            
            if (nextReset <= now) {
                nextReset.setDate(nextReset.getDate() + 1);
            }
            
            appState.nextResetTime = nextReset;
        }

        function updateResetTimer() {
            if (!appState.nextResetTime) return;
            
            const now = new Date();
            const diff = appState.nextResetTime.getTime() - now.getTime();
            
            if (diff <= 0) {
                document.getElementById('reset-timer').textContent = "00:00:00";
                // Auto reset when time reached
                resetAllItems(true);
                calculateNextResetTime(); // Set next reset time
                return;
            }
            
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            document.getElementById('reset-timer').textContent = 
                `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        // Theme functions
        function applyTheme() {
            document.body.className = document.body.className.replace(/theme-\w+/g, '');
            if (appState.settings.theme !== 'light') {
                document.body.classList.add(`theme-${appState.settings.theme}`);
            }
            if (appState.settings.theme === 'dark') {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
            
            // Apply animations setting
            if (!appState.settings.animations) {
                document.body.classList.add('no-animations');
            } else {
                document.body.classList.remove('no-animations');
            }
        }

        function selectTheme(theme) {
            appState.settings.theme = theme;
            applyTheme();
            saveState();
            
            // Update UI
            document.querySelectorAll('.theme-option').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.dataset.theme === theme) {
                    btn.classList.add('selected');
                }
            });
        }

        function toggleAnimations(enabled) {
            appState.settings.animations = enabled;
            applyTheme();
            saveState();
        }

        function toggleHourFormat(enabled) {
            appState.settings.hourFormat = enabled;
            saveState();
        }

        function toggleTimeFormat() {
            appState.settings.hourFormat = !appState.settings.hourFormat;
            document.getElementById('hour-format-toggle').checked = appState.settings.hourFormat;
            saveState();
        }

        function updateNotificationTime(time) {
            appState.settings.notificationTime = time;
            document.getElementById('notification-time').textContent = time;
            calculateNextResetTime();
            saveState();
        }

        // Progress functions
        function updateProgress() {
            const totalItems = appState.items.length;
            const completedItems = appState.items.filter(item => item.checked).length;
            const percentage = totalItems > 0 ? Math.round((completedItems / totalItems) * 100) : 0;
            
            // Update progress circle
            const circumference = 2 * Math.PI * 45;
            const strokeDashoffset = circumference - (percentage / 100) * circumference;
            document.getElementById('progress-circle').style.strokeDashoffset = strokeDashoffset;
            document.getElementById('progress-text').textContent = `${percentage}%`;
            
            // Update stats
            document.getElementById('completed-count').textContent = completedItems;
            document.getElementById('total-count').textContent = totalItems;
        }

        // Category functions
        function renderCategories() {
            const container = document.getElementById('categories-container');
            const categoriesWithItems = getCategoriesWithItems();
            
            if (categoriesWithItems.length === 0) {
                container.innerHTML = '';
                document.getElementById('empty-state').classList.remove('hidden');
                return;
            }
            
            document.getElementById('empty-state').classList.add('hidden');
            
            container.innerHTML = categoriesWithItems.map(({ category, items }) => {
                const isExpanded = appState.expandedCategories.has(category.id);
                const completedCount = items.filter(item => item.checked).length;
                
                return `
                    <div class="bg-card rounded-2xl shadow-lg border border-border overflow-hidden transition-all duration-300">
                        <div class="p-4 border-b border-border/50 flex items-center justify-between cursor-pointer hover:bg-muted/30 transition-colors duration-200"
                             style="background-color: ${category.color}15"
                             onclick="toggleCategory('${category.id}')"
                             data-testid="category-header-${category.id}">
                            <div class="flex items-center space-x-3">
                                <div class="w-4 h-4 rounded-full" style="background-color: ${category.color}"></div>
                                <h3 class="text-lg font-semibold text-foreground">${category.name}</h3>
                                <span class="text-sm text-muted-foreground">(${completedCount}/${items.length})</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                ${!category.isSpecial ? `
                                    <button class="btn btn-ghost p-1 h-auto text-muted-foreground hover:text-foreground"
                                            onclick="event.stopPropagation(); editCategory('${category.id}')"
                                            data-testid="button-edit-category-${category.id}">
                                        <i data-lucide="edit" class="h-4 w-4"></i>
                                    </button>
                                    <button class="btn btn-ghost p-1 h-auto text-red-400 hover:text-red-600"
                                            onclick="event.stopPropagation(); deleteCategory('${category.id}')"
                                            data-testid="button-delete-category-${category.id}">
                                        <i data-lucide="trash-2" class="h-4 w-4"></i>
                                    </button>
                                ` : ''}
                                <i data-lucide="chevron-down" class="h-5 w-5 transition-transform duration-300 dropdown-arrow ${isExpanded ? 'expanded' : ''}"></i>
                            </div>
                        </div>
                        <div class="category-items transition-all duration-300 overflow-hidden ${isExpanded ? 'expanded' : 'collapsed'}"
                             style="max-height: ${isExpanded ? items.length * 80 : 0}px">
                            ${items.map(item => `
                                <div class="flex items-center justify-between p-4 border-b border-border/30 last:border-b-0 hover:bg-muted/30 transition-colors duration-200">
                                    <div class="flex items-center space-x-3">
                                        <div class="checkbox ${item.checked ? 'checked' : ''}" 
                                             onclick="toggleItem('${item.id}')"
                                             data-testid="checkbox-item-${item.id}">
                                            ${item.checked ? '<i data-lucide="check" class="w-4 h-4"></i>' : ''}
                                        </div>
                                        <label class="text-foreground font-medium cursor-pointer transition-all duration-200 ${item.checked ? 'line-through text-muted-foreground' : ''}"
                                               onclick="toggleItem('${item.id}')">
                                            ${item.name}
                                        </label>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <button class="btn btn-ghost p-1 h-auto text-muted-foreground hover:text-foreground"
                                                onclick="editItem('${item.id}')"
                                                data-testid="button-edit-item-${item.id}">
                                            <i data-lucide="edit" class="h-4 w-4"></i>
                                        </button>
                                        <button class="btn btn-ghost p-1 h-auto text-red-400 hover:text-red-600"
                                                onclick="deleteItem('${item.id}')"
                                                data-testid="button-delete-item-${item.id}">
                                            <i data-lucide="trash-2" class="h-4 w-4"></i>
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
            
            // Re-initialize Lucide icons
            lucide.createIcons();
        }

        function getCategoriesWithItems() {
            const categoriesWithItems = [];
            
            // Add Unsorted category if there are unsorted items
            const unsortedItems = appState.items.filter(item => item.categoryId === 'unsorted');
            if (unsortedItems.length > 0) {
                const unsortedCategory = appState.categories.find(cat => cat.id === 'unsorted') || {
                    id: 'unsorted',
                    name: 'Unsorted',
                    color: '#6B7280',
                    isSpecial: true
                };
                categoriesWithItems.push({
                    category: unsortedCategory,
                    items: unsortedItems
                });
            }
            
            // Add other categories
            appState.categories.forEach(category => {
                if (category.id === 'unsorted') return;
                const categoryItems = appState.items.filter(item => item.categoryId === category.id);
                if (categoryItems.length > 0) {
                    categoriesWithItems.push({
                        category,
                        items: categoryItems
                    });
                }
            });
            
            return categoriesWithItems;
        }

        function updateCategorySelect() {
            const select = document.getElementById('item-category');
            select.innerHTML = '<option value="unsorted">Unsorted</option>';
            
            appState.categories.forEach(category => {
                if (category.id !== 'unsorted') {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    select.appendChild(option);
                }
            });
        }

        function toggleCategory(categoryId) {
            if (appState.expandedCategories.has(categoryId)) {
                appState.expandedCategories.delete(categoryId);
            } else {
                appState.expandedCategories.add(categoryId);
            }
            renderCategories();
        }

        function editCategory(categoryId) {
            const category = appState.categories.find(c => c.id === categoryId);
            if (!category || category.isSpecial) return;
            
            const newName = prompt('Edit category name:', category.name);
            if (newName && newName.trim() && newName.trim() !== category.name) {
                category.name = newName.trim();
                saveState();
                renderCategories();
                updateCategorySelect();
                showToast('Category updated successfully');
            }
        }

        function deleteCategory(categoryId) {
            if (confirm('Delete this category? Items will be moved to Unsorted.')) {
                // Move items to unsorted
                appState.items.forEach(item => {
                    if (item.categoryId === categoryId) {
                        item.categoryId = 'unsorted';
                    }
                });
                
                // Remove category
                appState.categories = appState.categories.filter(cat => cat.id !== categoryId);
                
                saveState();
                renderCategories();
                updateCategorySelect();
                showToast('Category deleted successfully');
            }
        }

        // Item functions
        function toggleItem(itemId) {
            const item = appState.items.find(i => i.id === itemId);
            if (item) {
                item.checked = !item.checked;
                saveState();
                renderCategories();
                updateProgress();
                
                if (appState.settings.animations && item.checked) {
                    // Add bounce animation to checkbox
                    setTimeout(() => {
                        const checkbox = document.querySelector(`[data-testid="checkbox-item-${itemId}"]`);
                        if (checkbox) {
                            checkbox.style.animation = 'bounce-subtle 0.6s ease-in-out';
                            setTimeout(() => {
                                checkbox.style.animation = '';
                            }, 600);
                        }
                    }, 50);
                }
            }
        }

        function editItem(itemId) {
            const item = appState.items.find(i => i.id === itemId);
            if (!item) return;
            
            const newName = prompt('Edit item name:', item.name);
            if (newName && newName.trim() && newName.trim() !== item.name) {
                item.name = newName.trim();
                saveState();
                renderCategories();
                showToast('Item updated successfully');
            }
        }

        function deleteItem(itemId) {
            if (confirm('Delete this item?')) {
                appState.items = appState.items.filter(item => item.id !== itemId);
                saveState();
                renderCategories();
                updateProgress();
                showToast('Item deleted successfully');
            }
        }

        function resetAllItems(sendNotification = false) {
            if (!sendNotification && !confirm('Reset all items? This will uncheck everything.')) {
                return;
            }
            
            appState.items.forEach(item => {
                item.checked = false;
            });
            saveState();
            renderCategories();
            updateProgress();
            
            if (sendNotification) {
                sendBrowserNotification('Essential Tracker', 'Daily essentials have been reset. Time to check your items!');
                showToast('Daily essentials automatically reset');
            } else {
                showToast('All items reset successfully');
            }
            
            calculateNextResetTime();
        }

        function deleteAllItems() {
            if (confirm('Delete all items? This action cannot be undone.')) {
                appState.items = [];
                saveState();
                renderCategories();
                updateProgress();
                showToast('All items deleted successfully');
            }
        }

        function deleteAllCategories() {
            if (confirm('Delete all categories? Items will be moved to Unsorted.')) {
                // Move all items to unsorted
                appState.items.forEach(item => {
                    item.categoryId = 'unsorted';
                });
                
                // Keep only the unsorted category
                appState.categories = appState.categories.filter(cat => cat.isSpecial);
                
                saveState();
                renderCategories();
                updateCategorySelect();
                showToast('All categories deleted successfully');
            }
        }

        // Modal functions
        function openAddItem() {
            updateCategorySelect();
            document.getElementById('add-item-modal').classList.remove('hidden');
            document.getElementById('item-name').focus();
        }

        function closeAddItem() {
            document.getElementById('add-item-modal').classList.add('hidden');
            document.getElementById('add-item-form').reset();
        }

        function openAddCategory() {
            selectedCategoryColor = '#EF4444';
            document.getElementById('add-category-modal').classList.remove('hidden');
            document.getElementById('category-name').focus();
        }

        function openAddCategoryFromItem() {
            closeAddItem();
            openAddCategory();
        }

        function closeAddCategory() {
            document.getElementById('add-category-modal').classList.add('hidden');
            document.getElementById('add-category-form').reset();
            selectedCategoryColor = '#EF4444';
            document.querySelectorAll('.color-option').forEach((option, index) => {
                option.classList.toggle('selected', index === 0);
            });
        }

        function openSettings() {
            // Update settings UI
            document.querySelectorAll('.theme-option').forEach(btn => {
                btn.classList.toggle('selected', btn.dataset.theme === appState.settings.theme);
            });
            document.getElementById('animations-toggle').checked = appState.settings.animations;
            document.getElementById('hour-format-toggle').checked = appState.settings.hourFormat;
            document.getElementById('notification-time-input').value = appState.settings.notificationTime;
            
            document.getElementById('settings-modal').classList.remove('hidden');
        }

        function closeSettings() {
            document.getElementById('settings-modal').classList.add('hidden');
        }

        function openEditNotification() {
            document.getElementById('edit-notification-time').value = appState.settings.notificationTime;
            document.getElementById('edit-notification-modal').classList.remove('hidden');
        }

        function closeEditNotification() {
            document.getElementById('edit-notification-modal').classList.add('hidden');
        }

        function toggleMenu() {
            const menu = document.getElementById('menu-dropdown');
            menu.classList.toggle('hidden');
        }

        // Color picker functions
        function selectColor(element) {
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('selected');
            });
            element.classList.add('selected');
            selectedCategoryColor = element.dataset.color;
            document.getElementById('custom-color').value = selectedCategoryColor;
        }

        function updateCustomColor(color) {
            selectedCategoryColor = color;
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('selected');
            });
        }

        // Notification functions
        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }

        function sendBrowserNotification(title, body) {
            if ('Notification' in window && Notification.permission === 'granted') {
                const notification = new Notification(title, {
                    body,
                    icon: '/favicon.ico',
                    tag: 'essential-tracker'
                });
                
                setTimeout(() => {
                    notification.close();
                }, 5000);
                
                notification.onclick = () => {
                    window.focus();
                    notification.close();
                };
            }
        }

        // Form handlers
        document.getElementById('add-item-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('item-name').value.trim();
            const categoryId = document.getElementById('item-category').value;
            
            if (name) {
                const item = {
                    id: generateId(),
                    name,
                    categoryId,
                    checked: false
                };
                
                appState.items.push(item);
                saveState();
                renderCategories();
                updateProgress();
                closeAddItem();
                showToast('Item added successfully');
            }
        });

        document.getElementById('add-category-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('category-name').value.trim();
            
            if (name) {
                const category = {
                    id: generateId(),
                    name,
                    color: selectedCategoryColor,
                    isSpecial: false
                };
                
                appState.categories.push(category);
                saveState();
                renderCategories();
                updateCategorySelect();
                closeAddCategory();
                showToast('Category added successfully');
            }
        });

        document.getElementById('edit-notification-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const time = document.getElementById('edit-notification-time').value;
            updateNotificationTime(time);
            closeEditNotification();
            showToast('Notification time updated successfully');
        });

        // Close modals when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal-overlay')) {
                e.target.classList.add('hidden');
            }
            
            // Close menu dropdown when clicking outside
            if (!e.target.closest('#menu-dropdown') && !e.target.closest('[data-testid="button-menu"]')) {
                document.getElementById('menu-dropdown').classList.add('hidden');
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                // Close any open modals
                document.querySelectorAll('.modal-overlay').forEach(modal => {
                    modal.classList.add('hidden');
                });
                document.getElementById('menu-dropdown').classList.add('hidden');
            }
        });

        // Initialize app
        function initApp() {
            loadState();
            applyTheme();
            calculateNextResetTime();
            updateDateTime();
            updateProgress();
            renderCategories();
            updateCategorySelect();
            requestNotificationPermission();
            
            // Update notification time display
            document.getElementById('notification-time').textContent = appState.settings.notificationTime;
            
            // Show app, hide loading
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            
            // Initialize Lucide icons
            lucide.createIcons();
            
            // Start intervals
            setInterval(updateDateTime, 1000);
            setInterval(updateResetTimer, 1000);
        }

        // Start the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>